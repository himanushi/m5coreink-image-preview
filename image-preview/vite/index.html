<!doctype html>
<html lang="ja" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0"
    />
    <title>Settings</title>
    <link rel="stylesheet" href="/pico.min.css" />
    <script type="text/javascript" src="/van.min.js"></script>
    <!-- <script type="module" src="/index.js"></script> -->
  </head>
  <body>
    <main id="main" class="container">
      <input type="file" id="imageInput" accept="image/*" />
      <canvas id="canvas"></canvas>

      <script>
        function convertImageToGrayscaleAndResize(src, callback) {
          const img = new Image();
          img.onload = function () {
            const targetWidth = 200;
            const targetHeight = 200;

            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");

            canvas.width = targetWidth;
            canvas.height = targetHeight;

            ctx.drawImage(img, 0, 0, targetWidth, targetHeight);

            const imageData = ctx.getImageData(0, 0, targetWidth, targetHeight);
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
              const brightness =
                0.34 * data[i] + 0.5 * data[i + 1] + 0.16 * data[i + 2];
              const grayscale = Math.round((brightness / 255) * 15);
              const colorValue = (grayscale / 15) * 255;
              data[i] = data[i + 1] = data[i + 2] = colorValue;
            }
            ctx.putImageData(imageData, 0, 0);
            callback(canvas);
          };
          img.src = src;
        }

        document
          .getElementById("imageInput")
          .addEventListener("change", function (event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function (e) {
              const src = e.target.result;
              convertImageToGrayscaleAndResize(src, function (canvas) {
                document.getElementById("main").appendChild(canvas);
              });
            };
            reader.readAsDataURL(file);
          });
      </script>
    </main>
  </body>
</html>
